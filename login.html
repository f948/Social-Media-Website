<html>   
   <head>
		
		<style>
		
body {font-family: Arial, Helvetica, sans-serif;}

/* Full-width input fields */
input[type=text], input[type=password] {
  width: 10%;
  padding: 12px 20px;
  margin: 8px 0;
  display: inline-block;
  border: 1px solid #ccc;
  box-sizing: border-box;
}

/* Set a style for all buttons */
#delete{
  background-color: #4CAF50;
  color: white;
  padding: 14px 20px;
  margin: 8px 0;
  border: none;
  cursor: pointer;
  width: 100%;
}

#delete:hover {
  opacity: 0.8;
}

/* Set a style for all buttons */
#contactDelete{
  background-color: #4CAF50;
  color: white;
  padding: 14px 20px;
  margin: 8px 0;
  border: none;
  cursor: pointer;
  width: 80px;
  height: 75 px;
  float: right;
}

#contactDelete:hover {
  opacity: 0.8;
}


/* Set a style for all buttons */
#view{
  background-color: #4CAF50;
  color: white;
  padding: 14px 20px;
  margin: 8px 0;
  border: none;
  cursor: pointer;
  width: 100%;
}

#view:hover {
  opacity: 0.8;
}

/* Set a style for all buttons */
#comments{
  background-color: #4CAF50;
  color: white;
  padding: 14px 20px;
  margin: 8px 0;
  border: none;
  cursor: pointer;
  width: 100%;
}

#comments:hover {
  opacity: 0.8;
}

/* Set a style for all buttons */
#edit{
  background-color: #4CAF50;
  color: white;
  padding: 14px 20px;
  margin: 8px 0;
  border: none;
  cursor: pointer;
  width: 100%;
}

#edit:hover {
  opacity: 0.8;
}

/* Set a style for all buttons */
#save{
  background-color: #4CAF50;
  color: white;
  padding: 14px 20px;
  margin: 8px 0;
  border: none;
  cursor: pointer;
  width: 100%;
}

#save:hover {
  opacity: 0.8;
}

/* Set a style for all buttons */
#submit{
  background-color: #4CAF50;
  color: white;
  padding: 14px 20px;
  margin: 8px 0;
  border: none;
  cursor: pointer;
  width: 10%;
}


#upload{
  background-color: #4CAF50;
  color: white;
  padding: 14px 20px;
  margin: 8px 0;
  border: none;
  cursor: pointer;
  width: 10%;
}

#change{
  background-color: #4CAF50;
  color: white;
  padding: 14px 20px;
  margin: 8px 0;
  border: none;
  cursor: pointer;
  width: 10%;
}

#add{
  background-color: #4CAF50;
  color: white;
  padding: 14px 20px;
  margin: 8px 0;
  border: none;
  cursor: pointer;
  width: 10%;
}



#submit:hover {
  opacity: 0.8;
}

#upload:hover {
  opacity: 0.8;
}
#change:hover {
  opacity: 0.8;
}

#add:hover {
  opacity: 0.8;
}



/* Extra styles for the cancel button */
.cancelbtn {
  width: auto;
  padding: 10px 18px;
  background-color: #f44336;
}

/* Center the image and position the close button */
.imgcontainer {
  text-align: center;
  margin: 24px 0 12px 0;
  position: relative;
}

img.avatar {
  width: 40%;
  border-radius: 50%;
}

.container {
  padding: 16px;
}

span.psw {
  float: right;
  padding-top: 16px;
}

/* The Modal (background) */
.modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
  padding-top: 60px;
}

/* Modal Content/Box */
.modal-content {
  background-color: #fefefe;
  margin: 5% auto 15% auto; /* 5% from the top, 15% from the bottom and centered */
  border: 1px solid #888;
  width: 80%; /* Could be more or less, depending on screen size */
}

/* The Close Button (x) */
.close {
  position: absolute;
  right: 25px;
  top: 0;
  color: #000;
  font-size: 35px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: red;
  cursor: pointer;
}

/* Add Zoom Animation */
.animate {
  -webkit-animation: animatezoom 0.6s;
  animation: animatezoom 0.6s
}

@-webkit-keyframes animatezoom {
  from {-webkit-transform: scale(0)} 
  to {-webkit-transform: scale(1)}
}
  
@keyframes animatezoom {
  from {transform: scale(0)} 
  to {transform: scale(1)}
}

/* Change styles for span and cancel button on extra small screens */
@media screen and (max-width: 300px) {
  span.psw {
     display: block;
     float: none;
  }
  .cancelbtn {
     width: 100%;
  }
}

#webPages {
  font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
  border-collapse: collapse;
  width: 100%;
}

#webPages td, #webPages th {
  border: 1px solid #ddd;
  padding: 8px;
}

#webPages tr:nth-child(even){background-color: #f2f2f2;}

#webPages  tr:hover {background-color: #ddd;}

#webPages th {
  padding-top: 12px;
  padding-bottom: 12px;
  text-align: left;
  background-color: #4CAF50;
  color: white;
}

.navbar {
  overflow: hidden;
  background-color: black;
}
.navbar a {
  float: left;
  display: block;
  color: white;
  text-align: center;
  padding: 14px 20px;
  text-decoration: none;
}

table {
    border: 1px solid #CCC;
    border-collapse: collapse;
}

td {
    border: none;
}

.chat {
  list-style-type: none;
  width: 20em;
}

.chat__bubble {
  margin-bottom: 3px;
  padding: 5px 10px;
  clear: both;
  border-radius: 10px 10px 2px 2px ;
}

.chat__bubble--rcvd {
  background: #f2f2f2;
  color: black;
  float: left;
  border-bottom-right-radius: 10px;
}

.chat__bubble--sent {
  background: #0066ff;
  color: white;
  float: right;
  border-bottom-left-radius: 10px;
}

.chat__bubble--sent + .chat__bubble--sent {
  border-top-right-radius: 2px;
}

.chat__bubble--rcvd + .chat__bubble--rcvd {
  border-top-left-radius: 2px;
}

.conversation{
	height: calc(100% - 50px);
	overflow: auto;
	padding: 2px;
	padding-bottom: 0;
}


/* The Modal (background) */
.modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  padding-top: 100px; /* Location of the box */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

.modal-content{
	background-color: #fff;
	height: 400px;
	width: 300px;
	margin: 0 auto;
	box-shadow: 0 2px 2px rgba(0,0,0,.2);
}


/* The Close Button */
.close {
  color: #aaaaaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,

.close:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
}



/* Set a style for the button */
.text{
  height:50px;
  width:250px;
  float:left;
 }
 
 /* Set a style for the button */
.btn{
  height:50px;
  width:50px;
  float:right;
 }
 
 .btn:hover {
  opacity: 0.8;
}

.non creator{
	float:left;
	border-bottom-left-radius: 10px;
}

.creator{
	float:right;
	border-bottom-left-radius: 10px;
}





</style>
			<div class="navbar">
<a href="register.html">Register</a>
 <a href="login.html">Login</a>
  <a href="search.html">Search</a>
 <a href="update.html">Update Account</a>
</div>
</div>
		
		<div class="container" id="container">
			<h1>Login</h1>
			<p>Fill in this form to log into your account</p>
			<br>
			<label for="username"><b>Username</b></label>
			<input type="password"   id="username"name="username">
			<br>
			<label for="password"><b>Password</b></label>
			<input type="password" id="password" name="password">
			<br>
			<input type="button" id="submit" name="submit" value="Submit" onclick="submit()">
			
		</div>
	
			<table id="webPages">
			
			</table>
			<br>
			
<!-- The Modal -->
<div id="modal" class="modal">

  <!-- Modal content -->
  <div class="modal-content">
    <div class="conversation">

    <span class="close" onclick="closeModal()">&times;</span>
    <ul id ="messages" class="chat">
	</ul>
	</div>
	<div> 
	<textarea class="text" id="commenting" ></textarea>
	<img onclick="sendComment()" class="btn" width="50" height="50"src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQUrk-Z6h6oLLy7GPkCAQe7kZLJIvRP1mO7JQ&usqp=CAU"><br>
	<input type="file" id="messageFile"></input>
	</div>
	</div>
		
			
			<script src = "/socket.io/socket.io.js"></script>
			<script>
				var socket = io();
				
				var username = document.getElementById("username");
				var password = document.getElementById("password");
				var div = document.getElementById("container");
				var webPagesTable=document.getElementById("webPages");
				var commentsList = document.getElementById("messages");
				var modal = document.getElementById("modal");
				var span = document.getElementsByClassName("close")[0];
				var commentTextBox = document.getElementById("commenting");
				var fileName="",setFileName,comment="";
				var selfUsername,i,descriptionBox,image,imageSource="",imageWidth,imageHeight,fileContent,input,commentsString="";
				var currentDate,fileContent="",selectFile,imageContent,profileImage,titleBox,profileImageDiv,title,description,errorMessages="";
				var imageClick=false,response=false,deleteBtnClick=false,shareClick=false,messageClick=false;
				var newTitle,newFileName,newDescription,reciever,user;
				var searchDescription,searchTitle,countedWords=[];
				var fileUpload="",webPageSender;
				
				const alphaumericCharacters= ["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];
				const stopwords = ["i", "me", "my", "myself", "we", "our", "ours", "ourselves", "you", "your", "yours", "yourself", "yourselves", "he", "him", "his", "himself", "she", "her", "hers", "herself", "it", "its", "itself", "they", "them", "their", "theirs", "themselves", "what", "which", "who", "whom", "this", "that", "these", "those", "am", "is", "are", "was", "were", "be", "been", "being", "have", "has", "had", "having", "do", "does", "did", "doing", "a", "an", "the", "and", "but", "if", "or", "because", "as", "until", "while", "of", "at", "by", "for", "with", "about", "against", "between", "into", "through", "during", "before", "after", "above", "below", "to", "from", "up", "down", "in", "out", "on", "off", "over", "under", "again", "further", "then", "once", "here", "there", "when", "where", "why", "how", "all", "any", "both", "each", "few", "more", "most", "other", "some", "such", "no", "nor", "not", "only", "own", "same", "so", "than", "too", "very", "s", "t", "can", "will", "just", "don", "should", "now"];
				const videoAndAudioFileExtensions=["mpg","mpeg","avi","wmv","mov","rm","ram","swf","flv","mid","midi","wma","aac","mp4","webm","mp3","wav","ogg"];
				const imageFileExtensions=["jpg","jpeg","png","gif"];
				const allowedFileTypes =["mpg","mpeg","avi","wmv","mov","rm","ram","swf","flv","mid","midi","wma","aac","mp4","webm","mp3","wav","ogg","jpg","jpeg","png","gif",""];
				
				function submit(){
					
					username.value=username.value.trim();
					password.value=password.value.trim();
					
					socket.emit("validateLoginInfo",{username:username.value,password:password.value});
					
				}
				
				function openModal(){
				
					modal.style.display='block';
			
				}
			
				function closeModal(){
					
					messageClick=false;
					imageClick=false;
					
					modal.style.display='none';
					
				}
				
				function upload(){
				
					fileName="";
					errorMessages="";
					
					if (!allowedFileTypes.includes(input.value.split(".")[input.value.split(".").length-1])){
						alert("File type is invalid"+"\n"+"File types that are allowed include mpg,mpeg,avi,wmv,mov,rm,ram,swf,flv,mid,midi,wma,aac,mp4,webm,mp3,wav,ogg,jpg,jpeg,png,gif");
						return 0;
					}
					
					if(input.value.length !=0){
						
						for(i=0;i<=input.value.split(".").length-2;i++){
							fileName+=input.value.split(".")[i]+".";
						}
						
						fileName=fileName.slice(0,fileName.length-1);
						
					}
					
					else if(input.value.length == 0){
						fileName="NO FILE ATTACHMENT";
					}
					
						title=titleBox.value.trim();
						
						if(title.length == 0){
							title="NO TITLE";
						}
						
						else if(title.length > 100){
							errorMessages+="Title must not be longer than 100 characters"+"\n";
						}
						
						description=descriptionBox.value.trim();
						
						if(description.length == 0){
							description="NO DESCRIPTION";
						}
						
						else if(description.length > 5000){
							errorMessages+="Description must not be longer than 5000 characters";
						}
						
						if(errorMessages == ""){
						
							currentDate = new Date();
					
		
							searchTitle=cleanString(title);
							searchDescription=cleanString(description);
						
							
							if(input.value.length == 0){
							
								if(optionsTable.value == "Public"){
									
									socket.emit("sendWebPage",{profileImg:'<img width="100" height="100" onclick="sharePost()"onerror="invalidProfileImage()"id="profile" src='+profileImage.src+'>',profileImageSrc:profileImage.src,username:selfUsername,title:title,searchTitle:searchTitle,name:fileName,code:"",image:'<img width='+image.width+'height='+image.height+' src='+image.src+'>',imageSrc:image.src,description:description,searchDescription:searchDescription,date: currentDate,status:"Public",imageHeight:image.height,imageWidth:image.width});
									
									alert("Post uploaded");

								}
								
								else if(optionsTable.value == "Private"){
								
									reciever = prompt("Type the name of the reciever");
									
									if(reciever != null){
										
										reciever=reciever.trim();
										
										socket.emit("sendWebPage",{profileImg:'<img width="100" height="100" onclick="sharePost()"onerror="invalidProfileImage()"id="profile" src='+profileImage.src+'>',profileImageSrc:profileImage.src,username:selfUsername,title:title,searchTitle:searchTitle,name:fileName,code:"",image:'<img width='+image.width+' height='+image.height+' src='+image.src+'>',imageSrc:image.src,description:description,searchDescription:searchDescription,date: currentDate,status:"Private",reciever:reciever,imageHeight:image.height,imageWidth:image.width});
									
										alert("Post uploaded");

									}
									
									
								}
							}
						
							else if(input.value.length != 0){
						
								
								if(optionsTable.value == "Public"){
								
									socket.emit("sendWebPage",{profileImg:'<img width="100" height="100" onclick="sharePost()"onerror="invalidProfileImage()"id="profile" src='+profileImage.src+'>',profileImageSrc:profileImage.src,username:	selfUsername,title:title,searchTitle:searchTitle,name:fileName+"."+input.value.split(".")[input.value.split(".").length-1],code:fileContent,image:'<img width='+image.width+'height='+image.height+' src='+image.src+'>',imageSrc:image.src,description:description,searchDescription:searchDescription,date: currentDate,status:"Public",imageHeight:image.height,imageWidth:image.width});
									
									alert("Post uploaded");

									
								}
								
								else if(optionsTable.value == "Private"){
								
									reciever = prompt("Type the name of the reciever");
									
									if(reciever != null){
									
										reciever=reciever.trim();
									
										socket.emit("sendWebPage",{profileImg:'<img width="100" height="100" onclick="sharePost()"onerror="invalidProfileImage()"id="profile" src='+profileImage.src+'>',profileImageSrc:profileImage.src,username:selfUsername,title:title,searchTitle:searchTitle,name:fileName+"."+input.value.split(".")[input.value.split(".").length-1],code:fileContent,image:'<img width='+image.width+' height='+image.height+' src='+image.src+'>',imageSrc:image.src,description:description,searchDescription:searchDescription,date: currentDate,status:"Private",reciever:reciever,imageHeight:image.height,imageWidth:image.width});
										
										alert("Post uploaded");

									}
								}
					
							
							}
						
						
						}
						
						else if(errorMessages !=""){
							alert(errorMessages);
						}
	
				}
				
				function addImage(){
					
					image.src = prompt("What is the image link?");
					
				}
				
				function addProfileImage(){
				
					profileImage.src= prompt("What is your profile image link?");
					
				}
				
				function invalidThumbnailImage(){
				
					image.src="https://bondconsultingservices.com/wp-content/uploads/2017/01/image-icon-goes-here.png";
					
				}
				
				function invalidProfileImage(){
			
					profileImage.src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRm_kVdMwEYyU95pNWTknAUfKokV1owQDTaVA&usqp=CAU";
					
				}
				
				function saveProfileImage(){
				
					socket.emit("updateProfileImage",{profileImg:'<img width="100" height="100" onerror="invalidProfileImage()"id="profile" src='+profileImage.src+'>',username:selfUsername,profileImageSrc:profileImage.src});
				}

				function cleanString(keyword){
					
					keyword=keyword.trim();
					
					keyword=keyword.split("");
					
					newKeyword="";
					
					// remove non alphanumeric characters
					for(i=0;i<=keyword.length-1;i++){
						
						if(!alphaumericCharacters.includes(keyword[i].toLowerCase())){
							keyword[i]=" ";
						}
					}
					
					for(i=0;i<=keyword.length-1;i++){
						
						newKeyword+=keyword[i];
					}
					
					
					newKeyword= newKeyword.split(" ");
					keyword="";
					
					// remove stopwords
					for(i=0;i<=newKeyword.length-1;i++){
						
						if(!stopwords.includes(newKeyword[i].toLowerCase()) && newKeyword[i].trim().length != 0){
							keyword+=newKeyword[i].toLowerCase()+ " ";
						}
					}
					
					keyword=keyword.trim();
					
					return keyword;
				}
				
			
				
				socket.on("login",function(login){
						
						if(login){
							
							selfUsername=username.value;
							
							socket.emit("getProfileImage",selfUsername);
							
							
							div.innerHTML = '<p>Upload a profile image</p><br>\
							<div id="profileImageDiv"><img width="100" height="100" onerror="invalidProfileImage()"id="profile" src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRm_kVdMwEYyU95pNWTknAUfKokV1owQDTaVA&usqp=CAU"></div><br>\
							<input type="button" value="Send Link" onclick="addProfileImage()">\
							<input type="file" id="profile image"><br><input type="button" value="Save" onclick="saveProfileImage()"><br>\
											<br><p>Give your post a title and a description</p>\
											<textarea style="width:300px;height:75px" id="title" name="title" placeholder="Type a title here" ></textarea><br><br>\
											<textarea style="width:300px;height:150px" id="description" name="description" placeholder="Type a description here" ></textarea><br>\
											<p>Attach a thumbnail image</p><br>\
							<img width="300" height="300" id="image" onerror="invalidThumbnailImage()" src="https://bondconsultingservices.com/wp-content/uploads/2017/01/image-icon-goes-here.png"><br>\
							<input type="button" value="Send Link" onclick="addImage()">\
							<input type="file" id="computer image"><br>\
							<p>Choose the height-width ratio</p>\
							<input id="height-width"type="range" min="67" max="150" value="100" oninput="changeHeightWidth()"><br>\
							<p id="zoom">100%</p>\
							<p>Attach a file to your post</p>\
							<input type="file" id="file"><br>\
							<p>Select who can view your post</p>\
							<select id="options">\
								<option value="Public">Public</option>\
								<option value="Private">Private</option>\
							</select>\
							<p>Click to upload your post</p>\
							<input type="button" id="upload"value="Upload" onclick="upload()">\
							<hr>\
							<select id="userPosts" onchange="getPosts()">\
								<option value="Publically Sent">Publically Sent Posts</option>\
								<option value="Privately Sent">Privately Sent Posts</option>\
								<option value="Privately Recieved">Privately Recieved Posts</option>\
								<option value="Shared">Shared With Me</option>\
								<option value="Contacts">Contacts</option>\
							</select>\
							<br>';
							
							messageFile = document.getElementById("messageFile");
							optionsTable=document.getElementById("options");
							titleBox=document.getElementById("title");
							descriptionBox=document.getElementById("description");		
							image = document.getElementById("image");
							input = document.getElementById("file");
							selectFile = document.getElementById("computer image");
							userPostsTable=document.getElementById("userPosts");
							heightWidth = document.getElementById("height-width");
							heightWidthText = document.getElementById("zoom");
							profileInput = document.getElementById("profile image");
							profileImageDiv = document.getElementById("profileImageDiv");
							
							input.addEventListener("change", function () {
								if (this.files && this.files[0]) {
									var myFile = this.files[0];
									var reader = new FileReader();
		
									reader.addEventListener('load', function (event) {
										fileContent = event.target.result;
										
									});
									
									
										if(videoAndAudioFileExtensions.includes(input.value.split(".")[input.value.split(".").length-1])){
									
											reader.readAsArrayBuffer(myFile);
										
										}
									
										else if(imageFileExtensions.includes(input.value.split(".")[input.value.split(".").length-1])){
									
											reader.readAsDataURL(myFile);
											
										}
									
									
											
										
										
									}
									
									
									
									
								
							});
							
							selectFile.addEventListener("change", function () {
								if (this.files && this.files[0]) {
									var myFile = this.files[0];
									var reader = new FileReader();
		
									reader.addEventListener('load', function (event) {
										image.src = event.target.result;
									});
									
									reader.readAsDataURL(myFile);
							
								}   
							});
							
							profileInput.addEventListener("change", function () {
								if (this.files && this.files[0]) {
									var myFile = this.files[0];
									var reader = new FileReader();
		
									reader.addEventListener('load', function (event) {
										profileImage.src = event.target.result;
	
									});
									
									
									reader.readAsDataURL(myFile);
										
									
										
									
										
								}   
							});
							
							
							messageFile.addEventListener("change", function () {
								if (this.files && this.files[0]) {
									var myFile = this.files[0];
									var reader = new FileReader();
		
									reader.addEventListener('load', function (event) {
										fileContent = event.target.result;
										
										if(["mpg","mpeg","avi","wmv","mov","rm","ram","swf","flv","mid","midi","wma","aac","mp4","webm","mp3","wav","ogg","jpg","jpeg","png","gif"].includes(messageFile.value.split(".")[messageFile.value.split(".").length-1])){
										
										fileUpload="";
										
										for(i=0;i<=messageFile.value.split(".").length-2;i++){
											fileUpload+=messageFile.value.split(".")[i]+".";
										}
						
										fileUpload=fileUpload.slice(0,fileUpload.length-1);
						
										if(videoAndAudioFileExtensions.includes(messageFile.value.split(".")[messageFile.value.split(".").length-1])){
									
											
											if(["mpg","mpeg","avi","wmv","mov","rm","ram","swf","flv","mid","midi","wma","aac","mp4"].includes(messageFile.value.split(".")[messageFile.value.split(".").length-1])){
												
												
												if(!messageClick){
												
													if(webPageSender != selfUsername){
														socket.emit("addComment",{type:"video",webPageFileName:fileName,name:fileUpload+"."+messageFile.value.split(".")[		messageFile.value.split(".").length-1],code:fileContent,sender:"Non Creator"});
													}
												
													else if(webPageSender == selfUsername){
														socket.emit("addComment",{type:"video",webPageFileName:fileName,name:fileUpload+"."+messageFile.value.split(".")[		messageFile.value.split(".").length-1],code:fileContent,sender:"Creator"});
													}
												}
												
												else if(messageClick){
											
													socket.emit("addMessage",{type:"video",sender:selfUsername,reciever:currentContact,name:fileUpload+"."+messageFile.value.split(".")[messageFile.value.split(".").length-1],code:fileContent});

						
												}
												
											}
											
											else if(["webm","mp3","wav","ogg","jpg","jpeg","png","gif"].includes(messageFile.value.split(".")[messageFile.value.split(".").length-1])){
												
												if(!messageClick){
													if(webPageSender != selfUsername){
														socket.emit("addComment",{type:"audio",webPageFileName:fileName,name:fileUpload+"."+messageFile.value.split(".")[messageFile.value.split(".").length-1],code:fileContent,sender:"Non Creator"});
											
													}
												
													else if(webPageSender == selfUsername){
														socket.emit("addComment",{type:"audio",webPageFileName:fileName,name:fileUpload+"."+messageFile.value.split(".")[messageFile.value.split(".").length-1],code:fileContent,sender:"Creator"});
											
													}
												}
												
												else if(messageClick){
											
													socket.emit("addMessage",{type:"audio",sender:selfUsername,reciever:currentContact,name:fileUpload+"."+messageFile.value.split(".")[messageFile.value.split(".").length-1],code:fileContent});

											
												}
											}
											
										}
									
										else if(imageFileExtensions.includes(messageFile.value.split(".")[messageFile.value.split(".").length-1])){
									
											
											if(!messageClick){
										
												if(webPageSender != selfUsername){
													socket.emit("addComment",{type:"image",webPageFileName:fileName,name:fileUpload+"."+messageFile.value.split(".")[messageFile.value.split(".").length-1],code:fileContent,sender:"Non Creator"});
											
												}
											
												else if(webPageSender == selfUsername){
													socket.emit("addComment",{type:"image",webPageFileName:fileName,name:fileUpload+"."+messageFile.value.split(".")[messageFile.value.split(".").length-1],code:fileContent,sender:"Creator"});
											
												}
											}
											
											else if(messageClick){
											
												socket.emit("addMessage",{type:"image",sender:selfUsername,reciever:currentContact,name:fileUpload+"."+messageFile.value.split(".")[messageFile.value.split(".").length-1],code:fileContent});

											
											}
											
										}
										
										if(!messageClick){
											socket.emit("sendComments",fileName);		
										}
										
										else if(messageClick){
											socket.emit("sendMessages",{sender:selfUsername,reciever:currentContact});		

										}
									}
									});
									
									
										
									
						
										if(videoAndAudioFileExtensions.includes(messageFile.value.split(".")[messageFile.value.split(".").length-1])){
									
											reader.readAsArrayBuffer(myFile);
										
	
										}
									
										else if(imageFileExtensions.includes(messageFile.value.split(".")[messageFile.value.split(".").length-1])){
									
											reader.readAsDataURL(myFile);
											
											
											
										}
									
										
									
									
									
									
									
								}   
							});
							
						}
						
						else{
							alert("Username or password was incorrect");
						}
					});
								
				function changeHeightWidth(){
					
					image.height=((heightWidth.value/100)*300).toString();
					image.width=(300*(1/(heightWidth.value/100))).toString();

					heightWidthText.innerHTML=heightWidth.value.toString()+"%";
				}
				
				function getPosts(){
					
					
					if(userPostsTable.value == "Publically Sent"){
					
						webPagesTable.innerHTML="";
						socket.emit("getPublicallySentWebPages",selfUsername);

					}
					
					else if(userPostsTable.value == "Privately Sent"){
					
						webPagesTable.innerHTML="";
						socket.emit("getPrivatelySentWebPages",selfUsername);
			
					}
					
					else if(userPostsTable.value == "Privately Recieved"){
					
						webPagesTable.innerHTML="";
						socket.emit("getPrivatelyRecievedWebPages",selfUsername);

					}
					
					else if(userPostsTable.value == "Shared"){
					
						webPagesTable.innerHTML="";
						socket.emit("getSharedWebPages",selfUsername);

					}
					
					else if(userPostsTable.value == "Contacts"){
					
						
						webPagesTable.innerHTML='<tr>\
												  <p>Type in contact username</p>\
												  <input type="text" id="contact">\
												  <input type="button" value="Add" onclick="addContact()">\
												  </tr>';
												  						
						socket.emit("sendContacts",selfUsername);
						
					}


				
				}
				
				socket.on("getPublicallySentWebPage",function(webPage){
						
						if(webPage.username == selfUsername && userPostsTable.value == "Publically Sent"){
							
							webPage.image='<img width='+webPage.imageWidth+' height='+webPage.imageHeight+'class="image" onclick="viewComments(\''+webPage.id.toString()+webPage.name+'\')" src='+webPage.imageSrc+'>';
						
							webPage.profileImg='<img width="100" height="100" class="image" onclick="sharePost(\''+webPage.id.toString()+'\')" src='+webPage.profileImageSrc+'>';
							
							
							if(webPage.name != "NO FILE ATTACHMENT"){
								webPagesTable.innerHTML+='<tr id=\''+webPage.id.toString()+'\' onclick="viewWebPage(\''+webPage.id.toString()+webPage.name+'\')">\
								<td>'+webPage.profileImg+'<br>'+webPage.username+'</td>\
								<td>'+webPage.image+'<br>'+webPage.title+"<br><br> Posted on "+webPage.dateString+'<br><br> File Attachment: '+webPage.name+'</td>\
								<td>'+webPage.description+'</td>\
								<td><input type="button" id="delete" value="Delete" onclick="deleteWebPage(\''+webPage.id.toString()+'\')"></td>\
								</tr>';
							}
						
							else if(webPage.name == "NO FILE ATTACHMENT"){
								webPagesTable.innerHTML+='<tr id=\''+webPage.id.toString()+'\' >\
								<td>'+webPage.profileImg+'<br>'+webPage.username+'</td>\
								<td>'+webPage.image+'<br>'+webPage.title+"<br><br> Posted on "+webPage.dateString+'<br><br> File Attachment: '+webPage.name+'</td>\
								<td>'+webPage.description+'</td>\
								<td><input type="button" id="delete" value="Delete" onclick="deleteWebPage(\''+webPage.id.toString()+'\')"></td>\
								</tr>';
							}
							
							
						}
				});
				
				socket.on("getPrivatelySentWebPage",function(webPage){
						
						
						if(webPage.username == selfUsername && userPostsTable.value == "Privately Sent"){
							
							webPage.image='<img width=\''+webPage.imageWidth+'\' height=\''+webPage.imageHeight+'\'class="image" onclick="viewComments(\''+webPage.id.toString()+webPage.name+'\')"  src='+webPage.imageSrc+'>';
							
							webPage.profileImg='<img width="100" height="100" class="image" onclick="sharePost(\''+webPage.id.toString()+'\')" src='+webPage.profileImageSrc+'>';
							
							if(webPage.name != "NO FILE ATTACHMENT"){
								webPagesTable.innerHTML+='<tr id=\''+webPage.id.toString()+'\' onclick="viewWebPage(\''+webPage.id.toString()+webPage.name+'\')">\
								<td>'+webPage.profileImg+'<br>'+webPage.username+'</td>\
								<td>'+webPage.image+'<br>'+webPage.title+"<br><br> Posted on "+webPage.dateString+'<br><br> File Attachment: '+webPage.name+'</td>\
								<td>'+webPage.description+'</td>\
								<td><input type="button" id="delete" value="Delete" onclick="deleteWebPage(\''+webPage.id.toString()+'\')"></td>\
								</tr>';
							}
						
							else if(webPage.name == "NO FILE ATTACHMENT"){
								webPagesTable.innerHTML+='<tr id=\''+webPage.id.toString()+'\' >\
								<td>'+webPage.profileImg+'<br>'+webPage.username+'</td>\
								<td>'+webPage.image+'<br>'+webPage.title+"<br><br> Posted on "+webPage.dateString+'<br><br> File Attachment: '+webPage.name+'</td>\
								<td>'+webPage.description+'</td>\
								<td><input type="button" id="delete" value="Delete" onclick="deleteWebPage(\''+webPage.id.toString()+'\')"></td>\
								</tr>';
							}
						}
				});
				
				socket.on("getPrivatelyRecievedWebPage",function(webPage){
						
						
						if(webPage.reciever == selfUsername && userPostsTable.value == "Privately Recieved"){
						
							webPage.image='<img width=\''+webPage.imageWidth+'\' height=\''+webPage.imageHeight+'\'class="image" onclick="viewComments(\''+webPage.id.toString()+webPage.name+'\')"  src='+webPage.imageSrc+'>';
						
							webPage.profileImg='<img width="100" height="100" class="image" onclick="sharePost(\''+webPage.id.toString()+'\')" src='+webPage.profileImageSrc+'>';
							
							if(webPage.name != "NO FILE ATTACHMENT"){
								webPagesTable.innerHTML+='<tr id=\''+webPage.id.toString()+'\' onclick="viewWebPage(\''+webPage.id.toString()+webPage.name+'\')">\
								<td>'+webPage.profileImg+'<br>'+webPage.username+'</td>\
								<td>'+webPage.image+'<br>'+webPage.title+"<br><br> Posted on "+webPage.dateString+'<br><br> File Attachment: '+webPage.name+'</td>\
								<td>'+webPage.description+'</td>\
								<td><input type="button" id="delete" value="Delete" onclick="deleteWebPage(\''+webPage.id.toString()+'\')"></td>\
								</tr>';
							}
						
							else if(webPage.name == "NO FILE ATTACHMENT"){
								webPagesTable.innerHTML+='<tr id=\''+webPage.id.toString()+'\' >\
								<td>'+webPage.profileImg+'<br>'+webPage.username+'</td>\
								<td>'+webPage.image+'<br>'+webPage.title+"<br><br> Posted on "+webPage.dateString+'<br><br> File Attachment: '+webPage.name+'</td>\
								<td>'+webPage.description+'</td>\
								<td><input type="button" id="delete" value="Delete" onclick="deleteWebPage(\''+webPage.id.toString()+'\')"></td>\
								</tr>';
							}
						}
				});
				
				socket.on("getSharedWebPage",function(webPage){
						
						
						if(webPage.reciever == selfUsername && userPostsTable.value == "Shared"){
						
							webPage.image='<img width=\''+webPage.imageWidth+'\' height=\''+webPage.imageHeight+'\'class="image" onclick="viewComments(\''+webPage.id.toString()+webPage.name+'\')"  src='+webPage.imageSrc+'>';

							webPage.profileImg='<img width="100" height="100" class="image" onclick="sharePost(\''+webPage.id.toString()+'\')" src='+webPage.profileImageSrc+'>';
							

							if(webPage.name != "NO FILE ATTACHMENT"){
								webPagesTable.innerHTML+='<tr id=\''+webPage.id.toString()+'\' onclick="viewWebPage(\''+webPage.id.toString()+webPage.name+'\')">\
								<td>'+webPage.profileImg+'<br>'+webPage.username+'</td>\
								<td>'+webPage.image+'<br>'+webPage.title+"<br><br> Shared by "+webPage.sharer+"<br><br> Posted on "+webPage.dateString+'<br><br> File Attachment: '+webPage.name+'</td>\
								<td>'+webPage.description+'</td>\
								<td><input type="button" id="delete" value="Delete" onclick="deleteWebPage(\''+webPage.id.toString()+'\')"></td>\
								</tr>';
							}
						
							else if(webPage.name == "NO FILE ATTACHMENT"){
								webPagesTable.innerHTML+='<tr id=\''+webPage.id.toString()+'\' >\
								<td>'+webPage.profileImg+'<br>'+webPage.username+'</td>\
								<td>'+webPage.image+'<br>'+webPage.title+"<br><br> Shared by "+webPage.sharer+"<br><br> Posted on "+webPage.dateString+'<br><br> File Attachment: '+webPage.name+'</td>\
								<td>'+webPage.description+'</td>\
								<td><input type="button" id="delete" value="Delete" onclick="deleteWebPage(\''+webPage.id.toString()+'\')"></td>\
								</tr>';
							}
						}
				});
				
				socket.on("getContact",function(contact){
						
					if(contact.username == selfUsername  && userPostsTable.value == "Contacts"){
						
						contact.profileImg='<img width="100" height="100" class="image"  src='+contact.profileImageSrc+'>';
						
						webPagesTable.innerHTML+='<tr id=\''+contact.contact+'\' onclick="viewMessages(\''+contact.contact+'\')">\
						<td>'+contact.profileImg+'<br>'+contact.contact+'</td>\
						<td><input type="button" id="contactDelete" value="Delete" onclick="deleteContact(\''+contact.contact+'\')"></td>\
						</tr>';
							
						}
				});

				socket.on("userNotExist",function(user){
					
					alert("Username "+user+" is not registered");
					
				});
				
				socket.on("sendProfileImage",function(image){
				
					profileImageDiv.innerHTML=image;
					
					profileImage = document.getElementById("profile");
					
					socket.emit("getPublicallySentWebPages",selfUsername);
										
				});
				
				function addContact(){
					
					socket.emit("addContact",{username:selfUsername,contact:document.getElementById("contact").value.trim()});
				}
				
				
				function sharePost(id){
				
					shareClick=true;
					
					user=prompt("Who do you want to share this post with?");
					
					if(user != null){
						user=user.trim();
						socket.emit("sharePost",{sharer:selfUsername,reciever:user,id:id});
					}
				}
				
				
				
				function viewComments(filename){
					
					imageClick=true;
					
					socket.emit("sendComments",filename);

					fileName=filename;
				}
				
				function viewMessages(contact){
					
					if(!deleteBtnClick){
					
						messageClick=true;
						
						socket.emit("sendMessages",{sender:selfUsername,reciever:contact});

						currentContact=contact;
					}
					
				
					deleteBtnClick=false;
				}
				
				function sendComment(){
					
					if(!messageClick){
				
						if(webPageSender != selfUsername){
							socket.emit("addComment",{type:"message",webPageFileName:fileName,code:commentTextBox.value.trim(),sender:"Non Creator"});
						}
					
						else if(webPageSender == selfUsername){
							socket.emit("addComment",{type:"message",webPageFileName:fileName,code:commentTextBox.value.trim(),sender:"Creator"});

						}
					
						socket.emit("sendComments",fileName);
					}
					
					else if(messageClick){
					
						socket.emit("addMessage",{type:"message",sender:selfUsername,reciever:currentContact,code:commentTextBox.value.trim()});
						socket.emit("sendMessages",{sender:selfUsername,reciever:currentContact});
					}
				}
				


				socket.on("getMessages",function(messages){
					
					commentsList.innerHTML="";

					for(i=0;i<=messages.length-1;i++){
			
						if(messages[i].type == "message"){
						
						commentsString="";
						
						for(j=0;j<=messages[i].code.length-1;j++){
							
							if((j+1)%20 == 0){
								commentsString+=messages[i].code[j]+"<br>";
							}
							
							else if((j+1)%20 != 0){
								commentsString+=messages[i].code[j];
							}
						}
						
						
						if(messages[i].sender != selfUsername){
							commentsList.innerHTML+='<li class="chat__bubble chat__bubble--rcvd">'+commentsString+'</li>';
						}
						
						else if(messages[i].sender == selfUsername){
							commentsList.innerHTML+='<li class="chat__bubble chat__bubble--sent">'+commentsString+'</li>';
						}
						
		
						}
						
						else if(messages[i].type == "image"){
						
						
						
							if(messages[i].sender != selfUsername){

								commentsList.innerHTML+='<img onclick="viewFile(\''+messages[i].name+'\')" class="chat__bubble chat__bubble--rcvd" width="120" height="75" src='+messages[i].code+'>';
							}
							
							else if(messages[i].sender == selfUsername){

								commentsList.innerHTML+='<img  onclick="viewFile(\''+messages[i].name+'\')"  class="chat__bubble chat__bubble--sent" width="120" height="75" src='+messages[i].code+'>';
							}
						}
						
						
						
						else if(messages[i].type == "video"){
						
							if(messages[i].sender != selfUsername){

								commentsList.innerHTML+='<img onclick="viewFile(\''+messages[i].name+'\')"  class="chat__bubble chat__bubble--rcvd"width="120" height="75"src="https://ak.picdn.net/shutterstock/videos/1047463780/thumb/5.jpg">';
							}
							
							else if(messages[i].sender == selfUsername){

								commentsList.innerHTML+='<img onclick="viewFile(\''+messages[i].name+'\')" class="chat__bubble chat__bubble--sent"width="120" height="75" src="https://ak.picdn.net/shutterstock/videos/1047463780/thumb/5.jpg">';
							}
						}
						
						else if(messages[i].type == "audio"){
						
							if(messages[i].sender != selfUsername){

								commentsList.innerHTML+='<img onclick="viewFile(\''+messages[i].name+'\')" class="chat__bubble chat__bubble--rcvd" width="120" height="75" src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS99onGOvd1WvWY4ICFzmUCbUQ_Ndov_p4wHw&usqp=CAU">';
							}
							
							else if(messages[i].sender == selfUsername){

								commentsList.innerHTML+='<img onclick="viewFile(\''+messages[i].name+'\')"  class="chat__bubble chat__bubble--sent" width="120" height="75" src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS99onGOvd1WvWY4ICFzmUCbUQ_Ndov_p4wHw&usqp=CAU">';
							}
						
						
						
						}
					}
					
					openModal();
					
					commentTextBox.placeholder="Type message here";
				});
				
				
				socket.on("getComments",function(data){
					
					if(data.file == fileName){
					
					webPageSender = data.sender;
					
					commentsList.innerHTML="";
					
					for(i=0;i<=data.comments.length-1;i++){
						
						if(data.comments[i].type == "message"){
						
						commentsString="";
						
						for(j=0;j<=data.comments[i].code.length-1;j++){
							
							if((j+1)%20 == 0){
								commentsString+=data.comments[i].code[j]+"<br>";
							}
							
							else if((j+1)%20 != 0){
								commentsString+=data.comments[i].code[j];
							}
						}
						
						if(webPageSender != selfUsername){
							if(data.comments[i].sender == "Creator"){
								commentsList.innerHTML+='<li class="chat__bubble chat__bubble--rcvd">'+commentsString+'</li>';
							}
						
							else if(data.comments[i].sender == "Non Creator"){
								commentsList.innerHTML+='<li class="chat__bubble chat__bubble--sent">'+commentsString+'</li>';
							}
						}
						
						else if(webPageSender == selfUsername){
							if(data.comments[i].sender == "Non Creator"){
								commentsList.innerHTML+='<li class="chat__bubble chat__bubble--rcvd">'+commentsString+'</li>';
							}
						
							else if(data.comments[i].sender == "Creator"){
								commentsList.innerHTML+='<li class="chat__bubble chat__bubble--sent">'+commentsString+'</li>';
							}
						}
						
						}
						
						else if(data.comments[i].type == "image"){
						
						if(webPageSender != selfUsername){
						
							if(data.comments[i].sender == "Creator"){

								commentsList.innerHTML+='<img onclick="viewFile(\''+data.comments[i].name+'\')" class="chat__bubble chat__bubble--rcvd" width="120" height="75" src='+data.comments[i].code+'>';
							}
							
							else if(data.comments[i].sender == "Non Creator"){

								commentsList.innerHTML+='<img  onclick="viewFile(\''+data.comments[i].name+'\')"  class="chat__bubble chat__bubble--sent" width="120" height="75" src='+data.comments[i].code+'>';
							}
							
						}
						
						
						else if(webPageSender == selfUsername){
						
							if(data.comments[i].sender == "Non Creator"){

								commentsList.innerHTML+='<img onclick="viewFile(\''+data.comments[i].name+'\')" class="chat__bubble chat__bubble--rcvd" width="120" height="75" src='+data.comments[i].code+'>';
							}
							
							else if(data.comments[i].sender == "Creator"){

								commentsList.innerHTML+='<img  onclick="viewFile(\''+data.comments[i].name+'\')"  class="chat__bubble chat__bubble--sent" width="120" height="75" src='+data.comments[i].code+'>';
							}
							
						}
						
						}
						
						else if(data.comments[i].type == "video"){
						
						if(webPageSender != selfUsername){
						
							if(data.comments[i].sender == "Creator"){

								commentsList.innerHTML+='<img onclick="viewFile(\''+data.comments[i].name+'\')"  class="chat__bubble chat__bubble--rcvd"width="120" height="75"src="https://ak.picdn.net/shutterstock/videos/1047463780/thumb/5.jpg">';
							}
							
							else if(data.comments[i].sender == "Non Creator"){

								commentsList.innerHTML+='<img onclick="viewFile(\''+data.comments[i].name+'\')" class="chat__bubble chat__bubble--sent"width="120" height="75" src="https://ak.picdn.net/shutterstock/videos/1047463780/thumb/5.jpg">';
							}
						}
						
						else if(webPageSender == selfUsername){
						
							if(data.comments[i].sender == "Non Creator"){

								commentsList.innerHTML+='<img onclick="viewFile(\''+data.comments[i].name+'\')"  class="chat__bubble chat__bubble--rcvd"width="120" height="75"src="https://ak.picdn.net/shutterstock/videos/1047463780/thumb/5.jpg">';
							}
							
							else if(data.comments[i].sender == "Creator"){

								commentsList.innerHTML+='<img onclick="viewFile(\''+data.comments[i].name+'\')" class="chat__bubble chat__bubble--sent"width="120" height="75" src="https://ak.picdn.net/shutterstock/videos/1047463780/thumb/5.jpg">';
							}
						}
						
						}
						
						else if(data.comments[i].type == "audio"){
						
						if(webPageSender != selfUsername){
						
							if(data.comments[i].sender == "Creator"){

								commentsList.innerHTML+='<img onclick="viewFile(\''+data.comments[i].name+'\')" class="chat__bubble chat__bubble--rcvd" width="120" height="75" src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS99onGOvd1WvWY4ICFzmUCbUQ_Ndov_p4wHw&usqp=CAU">';
							}
							
							else if(data.comments[i].sender == "Non Creator"){

								commentsList.innerHTML+='<img onclick="viewFile(\''+data.comments[i].name+'\')"  class="chat__bubble chat__bubble--sent" width="120" height="75" src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS99onGOvd1WvWY4ICFzmUCbUQ_Ndov_p4wHw&usqp=CAU">';
							}
						}
						
						else if(webPageSender == selfUsername){
						
							if(data.comments[i].sender == "Non Creator"){

								commentsList.innerHTML+='<img onclick="viewFile(\''+data.comments[i].name+'\')" class="chat__bubble chat__bubble--rcvd" width="120" height="75" src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS99onGOvd1WvWY4ICFzmUCbUQ_Ndov_p4wHw&usqp=CAU">';
							}
							
							else if(data.comments[i].sender == "Creator"){

								commentsList.innerHTML+='<img onclick="viewFile(\''+data.comments[i].name+'\')"  class="chat__bubble chat__bubble--sent" width="120" height="75" src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS99onGOvd1WvWY4ICFzmUCbUQ_Ndov_p4wHw&usqp=CAU">';
							}
						}
						}
					}
				
					openModal();
					
					commentTextBox.placeholder="Type comment here";
					
					}
				});
				
				
				function viewFile(file){
					
					
					if(!imageFileExtensions.includes(file.split(".")[file.split(".").length-1])){
						window.open(file);
					}	
					
					else if(imageFileExtensions.includes(file.split(".")[file.split(".").length-1])){
						
						if(!messageClick){
							socket.emit("sendCommentImageDataURL",file);
						}
						
						else if(messageClick){
							socket.emit("sendMessageImageDataURL",file);

						}
					}
				
				}
				
				
				function viewWebPage(file){
					
					
					if(!shareClick && !imageClick && !deleteBtnClick){
					
						if(!imageFileExtensions.includes(file.split(".")[file.split(".").length-1])){
							window.open(file);
						}	
					
						else if(imageFileExtensions.includes(file.split(".")[file.split(".").length-1])){
				
							socket.emit("sendImageDataURL",file);
						}
					}
					
					deleteBtnClick=false;
					imageClick=false;
					shareClick=false;
				}
				
				function deleteWebPage(id){
					
					deleteBtnClick=true;
					
					response=confirm("Do you want to permanantly delete this post?");
					
					if(response){
					
						document.getElementById(id).parentNode.removeChild(document.getElementById(id));
						
						socket.emit("deletePage",parseInt(id));
					}
					
				}
				
				function deleteContact(contact){
					
					deleteBtnClick=true;
					
					response=confirm("Do you want to permanantly delete this contact?");
					
					if(response){
					
						document.getElementById(contact).parentNode.removeChild(document.getElementById(contact));
						
						socket.emit("deleteContact",{username:selfUsername,contact:contact});
					}

				}
				
				socket.on("getImageDataURL",function(data){
					
					var tmpLink = document.createElement('a');
				
					tmpLink.download =data.name;
					tmpLink.href = data.URL;
				
					document.head.appendChild(tmpLink);
					tmpLink.click();
					document.head.removeChild(tmpLink);
					
				});
				
				

			</script>
   </head> 
</html>
